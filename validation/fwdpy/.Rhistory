sojTimes <- rep(0, length(bins))
# draw number of deleterious muts. on initial gamete
# want drawn initially onto fit background (less delet. mut. than avg.)
# k0 <- abs(U/s) # start at mean
# while(k0 >= abs(U/s)){ # find something with less than avg
#   k0 <- rpois(1, abs(U/s))
# }
# assume neutrality (3rd central moment is not 0, but just for now
# can use momentify package later. Requires compact support.
# y <- 0 # start at central mean
# while(y >= 0){
#   y <- rnorm(1,sd = sqrt(m2))
# }
y <- 3 * sqrt(m2)
sqrt(popSize * U) * epsilon
epsilon * y * p # initial strength of selection
epsilon * y * p / (p *(1-p)) # N s value from traditional popgen
pathdf <- data.table()
sojdf <- data.table()
# multiple reps from same initial condition
reps <- 1e3
for(i in 1:reps){
if(i %% 100 == 0) print(paste(i, "out of", reps))
# for O(epsilon^3) accuracy in the change to the focal freq (f0) we need
# 2rd order expansion of f1
# 1st order expansion of f2
# 0th order expansion of f3
# in powers of epsilon
# see overleaf that I'll make, or I can explain on the board
# intial conditions for the perturbative coefficients are
# (because no initial condition is a power of Ns)
f0 <- p
f1Order0 <- y * p
f1Order1 <- 0
f1Order2 <- 0
f2Order0 <- y^2 * p
f2Order1 <- 0
f3Order0 <- y^3 * p
t <- 0
# create vectors to hold sample paths
f0Vec <- c(f0)
f1Vec <- c(f1Order0 + epsilon * f1Order1 + epsilon^2 * f1Order2)
f2Vec <- c(f2Order0 + epsilon * f2Order1)
f3Vec <- c(f3Order0)
tVec <- c(0)
# evolve forward in time until absorption
while(!(f0 %in% c(0,1))){
# find which bin the current frequency falls in
# one less than the first bin with left endpoint greater than
# the current value
freqBin <- which(bins > f0)[1] - 1
# handle cases near fixation separately
if(f0 > max(bins)){freqBin <- length(sojTimes)}
# update sojTime vector
sojTimes[freqBin] <- sojTimes[freqBin] + 1
# f0 evolves stochastically
newf0 <- f0 + epsilon * (f1Order0 + epsilon * f1Order1 + epsilon^2 * f1Order2) * dt +
sqrt(f0 * (1 - f0)) * rnorm(1,0,sqrt(dt))
newf0 <- max(0,newf0)
newf0 <- min(1,newf0)
# moments >= 1 evolve deterministically according to the heirarchy derived in
# Good and Desai 2013 eq F.9
# because m2 is at deterministic steady state and f0 is given by the stochastic dynamics
# we replace their replica moments (e.g. f0,2) with products (e.g. f0 * m2)
# instead of taking the expectation of a product (and calling them replica moments) as they do
newf1Order0 <- f1Order0 - f1Order0 * dt
newf1Order1 <- f1Order1 + (- f1Order1 + f2Order0 - f0 * m2) * dt
newf1Order2 <- f1Order2 + (- f1Order2 + f2Order1) * dt
newf2Order0 <- f2Order0 + (popSize * U * f0 + f0 * m2 - 2 * f2Order0) * dt
newf2Order1 <- f2Order1 + (-2 * f2Order1 + f3Order0 - f1Order0 * m2) * dt
newf3Order0 <- f3Order0 + (popSize * U * f0 +3 * popSize * U * f1Order0 -
3 * f3Order0 + 3 * f1Order0 * m2) * dt
# reassign current values
f0 <- newf0
f1Order0 <- newf1Order0
f1Order1 <- newf1Order1
f1Order2 <- newf1Order2
f2Order0 <- newf2Order0
f2Order1 <- newf2Order1
f3Order0 <- newf3Order0
# iterate time
t <- t + dt
# save values
f0Vec <- c(f0Vec, f0)
f1Vec <- c(f1Vec, f1Order0 + epsilon * f1Order1 + epsilon^2 * f1Order2)
f2Vec <- c(f2Vec, f2Order0 + epsilon * f2Order1)
f3Vec <- c(f3Vec, f3Order0)
tVec <- c(tVec,t)
}
# save to data frame
pathdf <- bind_rows(pathdf,
data.table(f0 = f0Vec,
f1 = f1Vec,
f2 = f2Vec,
f3 = f3Vec,
t = tVec,
rep = i))
sojTimes <- sojTimes * dt
sojdf <- bind_rows(sojdf,
data.table(soj = sojTimes,
leftBound = bins,
rep = i))
}
tmp <- pathdf %>% melt(id.vars = c("t","rep"))
# %>%
# filter(t <= 1)
ggplot(tmp) +
geom_line(aes(x = t,
y = value,
color = as.factor(rep)),
linewidth = 1.05,
alpha = 0.6) +
facet_wrap(vars(variable),
scales = "free") +
theme_bw() +
guides(color = "none")
foo <- pathdf %>%
group_by(rep) %>%
filter(t %in% c(0,dt)) %>%
ungroup()
startFreq <- foo %>% filter(t == 0)
endFreq <- foo %>% filter(t == dt)
diff <- startFreq$f0 - endFreq$f0
mean(diff)
y * p * epsilon * dt
fk <- dpois(k,5)
k <- 1:100
fk <- dpois(k,5)
plot(k,fk)
df <- data.table(k = k
fk = fk)
df <- data.table(k = k
fk = fk)
df <- data.table(k = k,
fk = fk)
library(dplyr)
library(data.table)
librar(ggplot2)
df <- data.table(k = k,
fk = fk)
?geom_bar
library(ggplot2)
?geom_bar
)
ggplot(df) +
geom_bar(aes(x=k,
y = fk))
ggplot(df) +
geom_bar(aes(x = k,
y = fk))
ggplot(df) +
geom_bar(aes(x = k,
count = fk))
ggplot(df) +
geom_bar(aes(x = k,
y = fk))
ggplot(df) +
geom_col(aes(x = k,
y = fk))
df <- df %>% filter(l <= 10)
ggplot(df) +
geom_col(aes(x = k,
y = fk))
df <- df %>% filter(k <= 10)
ggplot(df) +
geom_col(aes(x = k,
y = fk))
df <- df %>% filter(k <= k)
ggplot(df) +
geom_col(aes(x = k,
y = fk))
df <- df %>% filter(k <= 5)
ggplot(df) +
geom_col(aes(x = k,
y = fk))
k <- 1:100
fk <- dpois(k,2)
plot(k,fk)
df <- data.table(k = k,
fk = fk)
df <- df %>% filter(k <= 5)
ggplot(df) +
geom_col(aes(x = k,
y = fk))
k <- 1:100
fk <- dpois(k,1)
plot(k,fk)
df <- data.table(k = k,
fk = fk)
df <- df %>% filter(k <= 5)
ggplot(df) +
geom_col(aes(x = k,
y = fk))
k <- 1:100
fk <- dpois(k,1.5)
plot(k,fk)
df <- data.table(k = k,
fk = fk)
df <- df %>% filter(k <= 5)
ggplot(df) +
geom_col(aes(x = k,
y = fk))
k <- 1:100
fk <- dpois(k,2)
plot(k,fk)
df <- data.table(k = k,
fk = fk)
df <- df %>% filter(k <= 5)
ggplot(df) +
geom_col(aes(x = k,
y = fk))
k <- 1:100
fk <- dpois(k,3)
plot(k,fk)
df <- data.table(k = k,
fk = fk)
df <- df %>% filter(k <= 5)
ggplot(df) +
geom_col(aes(x = k,
y = fk))
k <- 1:100
fk <- dpois(k,4)
plot(k,fk)
df <- data.table(k = k,
fk = fk)
df <- df %>% filter(k <= 5)
ggplot(df) +
geom_col(aes(x = k,
y = fk))
df <- df %>% filter(k <= 3)
ggplot(df) +
geom_col(aes(x = k,
y = fk))
k <- 0:100
fk <- dpois(k,4)
plot(k,fk)
df <- data.table(k = k,
fk = fk)
df <- df %>% filter(k <= 3)
ggplot(df) +
geom_col(aes(x = k,
y = fk))
k <- 0:100
fk <- dpois(k,3)
plot(k,fk)
df <- data.table(k = k,
fk = fk)
df <- df %>% filter(k <= 3)
ggplot(df) +
geom_col(aes(x = k,
y = fk))
k <- 0:100
fk <- dpois(k,2)
plot(k,fk)
df <- data.table(k = k,
fk = fk)
df <- df %>% filter(k <= 3)
ggplot(df) +
geom_col(aes(x = k,
y = fk))
ggplot(df) +
geom_col(aes(x = -k,
y = fk))
ggplot(df) +
geom_col(aes(x = k,
y = fk)) +
scale_x_discrete(limits=rev)
ggplot(df) +
geom_col(aes(x = k,
y = fk)) +
scale_x_discrete(limits=rev)
ggplot(df) +
geom_col(aes(x = k,
y = fk)) +
scale_x_reverse()
fk <- dpois(k,1)
plot(k,fk)
df <- data.table(k = k,
fk = fk)
df <- df %>% filter(k <= 3)
ggplot(df) +
geom_col(aes(x = k,
y = fk)) +
scale_x_reverse()
fk <- dpois(k,1.5)
plot(k,fk)
df <- data.table(k = k,
fk = fk)
df <- df %>% filter(k <= 3)
ggplot(df) +
geom_col(aes(x = k,
y = fk)) +
scale_x_reverse()
ggplot(df) +
geom_col(aes(x = k,
y = fk)) +
scale_x_reverse() +
theme_blank()
ggplot(df) +
geom_col(aes(x = k,
y = fk)) +
scale_x_reverse() +
theme_void()
ggplot(df) +
geom_col(aes(x = k,
y = fk),
fill = NA,
color = black) +
scale_x_reverse() +
theme_void()
ggplot(df) +
geom_col(aes(x = k,
y = fk),
fill = NA,
color = "black") +
scale_x_reverse() +
theme_void()
ggplot(df) +
geom_col(aes(x = k,
y = fk),
fill = NA,
color = "black",
linewidth = 1.1) +
scale_x_reverse() +
theme_void()
setwd("C:/Users/natha/OneDrive - UW-Madison/Documents")
setwd("C:/Users/natha/OneDrive - UW-Madison/Documents")
library(dplyr)
library(data.table)
library(ggplot2)
df <- fread("varData.csv")
names(df) <- c("genVar", "sVal", "t")
df$t <- df$t %>% as.numeric()
df$t
df <- fread("varData.csv")
names(df) <- c("genVar", "sVal", "t")
df$t
library(DOSE)
install.packages("DOSE")
library(DOSE)
df$t %>% parse_ratio()
?parse
df$t %>% as.numeric( gsub("(\\d+)/(\\d+)", "\\1", xxx, perl=T) ) / as.numeric( gsub("(\\d+)/(\\d+)", "\\2", xxx, perl=T) )
df$t %>% as.numeric( gsub("(\\d+)/(\\d+)", "\\1", ., perl=T) ) / as.numeric( gsub("(\\d+)/(\\d+)", "\\2", ., perl=T) )
as.numeric( gsub("(\\d+)/(\\d+)", "\\1", df$t, perl=T) ) / as.numeric( gsub("(\\d+)/(\\d+)", "\\2", df$t, perl=T) )
df$t <- as.numeric( gsub("(\\d+)/(\\d+)", "\\1", df$t, perl=T) ) / as.numeric( gsub("(\\d+)/(\\d+)", "\\2", df$t, perl=T) )
df$genVar %>% gsub('[{}]', '', .)
df$genVar %>% gsub('[{}]', '', .) %>% as.numeric()
df$genVar <- df$genVar %>% gsub('[{}]', '', .) %>% as.numeric()
s <- seq(0.2,2,by=0.2)
length(unique(df$t))
max(df$t)
summary(df$t)
s <- seq(0.2,2,by=0.2)
df <- fread("varData.csv")
df$V3
df$V3[101]
tmp <- df$V3[101]
as.numeric( gsub("(\\d+)/(\\d+)", "\\1", tmp, perl=T) ) / as.numeric( gsub("(\\d+)/(\\d+)", "\\2", tmp, perl=T) )
library(gsubfn)
as.expression(tmp)
as.expression(df$V3)
as.numeric(
as.numeric(
gsubfn("([0-9]+)/([0-9]+)",
numerator+denominator~as.numeric(numerator)/as.numeric(denominator),
tmp, backref=-2)
)
install.packages("gsubfn")
library(gsubfn)
as.numeric(
gsubfn("([0-9]+)/([0-9]+)",
numerator+denominator~as.numeric(numerator)/as.numeric(denominator),
tmp, backref=-2))
names(df) <- c("genVar", "sVal", "t")
as.numeric(
gsubfn("([0-9]+)/([0-9]+)",
numerator+denominator~as.numeric(numerator)/as.numeric(denominator),
df$t, backref=-2))
tmp <- as.numeric(
gsubfn("([0-9]+)/([0-9]+)",
numerator+denominator~as.numeric(numerator)/as.numeric(denominator),
df$t, backref=-2))
summary(tmp)
setwd("C:/Users/natha/OneDrive - UW-Madison/Documents")
library(gsubfn)
df <- fread("varData.csv")
names(df) <- c("genVar", "sVal", "t")
df$t <- as.numeric(
gsubfn("([0-9]+)/([0-9]+)",
numerator+denominator~as.numeric(numerator)/as.numeric(denominator),
df$t, backref=-2))
df$genVar <- df$genVar %>% gsub('[{}]', '', .) %>% as.numeric()
s <- rep(seq(0.2,2,by=0.2), each = 2)
s <- rep(seq(0.2,2,by=0.2), each = 101)
df$sVal <- rep(seq(0.2,2,by=0.2), each = 101)
ggplot(df) +
geom_lines(aes(x = t-1,
y = genVar,
color = sVal))
ggplot(df) +
geom_line(aes(x = t-1,
y = genVar,
color = sVal))
df$sVal <- as.factor(rep(seq(0.2,2,by=0.2), each = 101))
ggplot(df) +
geom_line(aes(x = t-1,
y = genVar,
color = sVal))
20/1000
seq(0.2,2,by=0.2)
seq(0.2,2,by=0.4)
seq(0.2,2,length.out = 5)
equildf <- df %>% filter(t == min(t))
equildf <- df %>% filter(t == min(t)) %>% select(-t)
df <- merge(df, equildf)
setwd("C:/Users/natha/OneDrive - UW-Madison/Documents")
library(gsubfn)
df <- fread("varData.csv")
names(df) <- c("genVar", "sVal", "t")
df$t <- as.numeric(
gsubfn("([0-9]+)/([0-9]+)",
numerator+denominator~as.numeric(numerator)/as.numeric(denominator),
df$t, backref=-2))
df$genVar <- df$genVar %>% gsub('[{}]', '', .) %>% as.numeric()
df$sVal <- as.factor(rep(seq(0.2,2,by=0.2), each = 101))
equildf <- df %>% filter(t == min(t)) %>% select(-t)
names(equildf) <- c("equilVar", "sVal")
?merge
merge(df, equildf)
df <- merge(df, equildf)
df <- df %>% mutate(relVar = genVar / equilVar)
ggplot(df) +
geom_line(aes(x = t-1,
y = relVar,
color = sVal))
setwd("C:/Users/natha/OneDrive - UW-Madison/Documents")
library(gsubfn)
df <- fread("varData2.csv")
names(df) <- c("genVar", "sVal", "t")
df$t <- as.numeric(
gsubfn("([0-9]+)/([0-9]+)",
numerator+denominator~as.numeric(numerator)/as.numeric(denominator),
df$t, backref=-2))
df$genVar <- df$genVar %>% gsub('[{}]', '', .) %>% as.numeric()
ggplot(df) +
geom_line(aes(x = t-1,
y = genVar,
color = sVal))
ggplot(df) +
geom_line(aes(x = t-1,
y = genVar,
color = as.factor(sVal)))
equildf <- df %>% filter(t == min(t)) %>% select(-t)
names(equildf) <- c("equilVar", "sVal")
df <- merge(df, equildf)
df <- df %>% mutate(relVar = genVar / equilVar)
ggplot(df) +
geom_line(aes(x = t-1,
y = relVar,
color = sVal))
ggplot(df) +
geom_line(aes(x = t-1,
y = relVar,
color = as.factor(sVal)))
ggplot(df) +
geom_line(aes(x = t-1,
y = relVar,
color = as.factor(sVal)),
linewidth = 1.1) +
theme_bw()
ggplot(df) +
geom_line(aes(x = t-1,
y = relVar,
color = as.factor(sVal)),
linewidth = 1.1) +
theme_bw() +
ylab("Variance relative to ancestral") +
xlab("Time since bottleneck") +
labs(color = "2Ns")
ggplot(df) +
geom_line(aes(x = t-1,
y = relVar,
color = as.factor(sVal)),
linewidth = 1.1) +
theme_bw() +
ylab("Variance relative to ancestral") +
xlab("Time since bottleneck") +
labs(color = bquote(2 * N[A] * s))
ggplot(df) +
geom_line(aes(x = t-1,
y = relVar,
color = as.factor(sVal)),
linewidth = 1.1) +
theme_bw() +
ylab("Variance relative to ancestral") +
xlab("Time since bottleneck") +
labs(color = bquote(2 * N[A] * s)) +
theme(axis.title = element_text(size = 12))
setwd("C:/Users/natha/OneDrive - UW-Madison/Documents/GitHub/BGSdemo/validation/fwdpy")
library(dplyr)
master <- data.frame()
for(s in c(1e-3,5e-3,1e-2)){
for(n in c(1e3,5e3,1e4)){
master <- dplyr::bind_rows(master,
data.frame(s,
n))
}
}
master$tag <- 1:nrow(master)
write.table(master, file = "params.txt",
row.names = F,col.names = F, quote=F)
